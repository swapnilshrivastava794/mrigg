{% extends '../layout/layout.html' %}

{% block content %}

<!-- ..::Shop Section Start Here::.. -->
<div class="rts-shop-section">
    <div class="container">
        <div class="row">
            <div class="col-xl-9">
                <div class="shop-product-topbar">
                    <span class="items-onlist">
                        {% if products %}
                            Showing 1-{{ products|length }} of {{ product_count }} results
                        {% else %}
                            No products found
                        {% endif %}
                    </span>
                    <div class="filter-area">
                        <p class="select-area">
                            <select class="select">
                                <option value="*">Sort by average rating</option>
                                <option value=".popular">Sort by popularity</option>
                                <option value=".best-rate">Sort by latest</option>
                                <option value=".on-sale">Sort by price: low to high</option>
                                <option value=".featured">Sort by price: high to low</option>
                            </select>
                        </p>
                    </div>
                </div>
                <div class="products-area products-area3">
                    <div class="row justify-content-center">
                        {% if products %}
                            {% for product in products %}
                            <div class="col-xl-4 col-md-4 col-sm-6">
                                <div class="product-item product-item2 {% if product.featured %}element-item3{% elif product.popular %}popular{% else %}element-item1{% endif %}">
                                    <a href="{% url 'product_detail' product.subcategory.category.slug product.subcategory.slug product.slug %}" 
                                       class="product-image {% if product.images.all|length > 1 %}image-hover-variations{% endif %}">
                                        {% if product.images.all %}
                                            {% with images=product.images.all %}
                                                <div class="image-vari1 image-vari">
                                                    <img src="{{ images.0.image.url }}" alt="{{ product.name }}">
                                                </div>
                                                {% if images|length > 1 %}
                                                    <div class="image-vari2 image-vari">
                                                        <img src="{{ images.1.image.url }}" alt="{{ product.name }}">
                                                    </div>
                                                {% else %}
                                                    <div class="image-vari2 image-vari">
                                                        <img src="{{ images.0.image.url }}" alt="{{ product.name }}">
                                                    </div>
                                                {% endif %}
                                            {% endwith %}
                                        {% else %}
                                            <img src="/static/images/hand-picked/slider-img8_2.jpg" alt="{{ product.name }}">
                                        {% endif %}
                                    </a>
                                    <div class="bottom-content">
                                        <span class="product-category">{% if product.subcategory %}{{ product.subcategory.name }}{% endif %}</span>
                                        <a href="{% url 'product_detail' product.subcategory.category.slug product.subcategory.slug product.slug %}" class="product-name">{{ product.name }}</a>
                                        <div class="action-wrap">
                                            <span class="product-price">
                                                {% if product.offerprice and product.offerprice > 0 %}
                                                    <span class="old-price">₹{{ product.price }}</span> ₹{{ product.offerprice }}
                                                {% else %}
                                                    ₹{{ product.price }}
                                                {% endif %}
                                            </span>
                                            <a href="{% url 'add_to_cart' product.slug %}" class="addto-cart">
                                                <i class="fal fa-shopping-cart"></i> Add To Cart
                                            </a>
                                        </div>
                                    </div>
                                    {% if product.featured or product.latest or product.offerprice %}
                                    <div class="product-features">
                                        {% if product.latest %}<div class="new-tag product-tag">NEW</div>{% endif %}
                                        {% if product.featured %}<div class="hot-tag product-tag">HOT</div>{% endif %}
                                        {% if product.offerprice and product.offerprice > 0 and product.price > product.offerprice %}
                                            <div class="discount-tag product-tag">SALE</div>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                    <div class="product-actions">
                                        <a href="{% url 'add_to_wishlist' product.slug %}" class="product-action" title="Add to Wishlist">
                                            <i class="fal fa-heart"></i>
                                        </a>
                                        <a href="{% url 'product_detail' product.subcategory.category.slug product.subcategory.slug product.slug %}" class="product-action" title="View Details">
                                            <i class="fal fa-eye"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-12">
                                <div class="text-center" style="padding: 40px;">
                                    <p>No products found in this category.</p>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="product-pagination-area mt--20">
                    <button class="prev"><i class="far fa-long-arrow-left"></i></button>
                    <button class="number active">01</button>
                    <button class="number">02</button>
                    <button class="skip-number">---</button>
                    <button class="number">07</button>
                    <button class="number">08</button>
                    <button class="next"><i class="far fa-long-arrow-right"></i></button>
                </div>
            </div>
            <div class="col-xl-3">
                <div class="side-sticky">
                    <div class="shop-side-action">
                        <div class="action-item">
                            <div class="action-top">
                                <span class="action-title">PRODUCT CATEGORY</span>
                            </div>
                            {% for category in categories %}
                            <div class="category-item">
                                <div class="category-item-inner">
                                    <div class="category-title-area">
                                        <span class="point"></span>
                                        <span class="category-title">
                                            {{ category.name }} 
                                            ({{ category.active_subcategory_count }})
                                        </span>
                                    </div>
                                    <div class="down-icon"><i class="far fa-angle-down"></i></div>
                                </div>
                                {% if category.active_subcategories %}
                                <div class="sub-categorys">
                                    <ul class="sub-categorys-inner">
                                        {% for subcategory in category.active_subcategories %}
                                        <li>
                                            <span class="point"></span>
                                            <a href="{% url 'category-subcategory' category_slug=category.slug subcategory_slug=subcategory.slug %}">
                                                {{ subcategory.name }}
                                            </a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                {% endif %}
                            </div>
                            {% empty %}
                            <div class="category-item">
                                <p style="padding: 10px; color: #999;">No categories available</p>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="action-item">
                            <div class="action-top">
                                <span class="action-title">FILTER BY PRICE</span>
                            </div>
                            <form id="price-filter-form" method="get" action="{% if selected_subcategory %}{% url 'category-subcategory' category_slug=selected_category.slug subcategory_slug=selected_subcategory.slug %}{% elif selected_category %}{% url 'category-only' category_slug=selected_category.slug %}{% else %}{% url 'shop' %}{% endif %}">
                                {% if selected_brand %}<input type="hidden" name="brand" value="{{ selected_brand }}">{% endif %}
                                {% if selected_color %}<input type="hidden" name="color" value="{{ selected_color }}">{% endif %}
                                <input type="hidden" name="price_min" id="price_min" value="{{ current_price_min }}">
                                <input type="hidden" name="price_max" id="price_max" value="{{ current_price_max }}">
                                <div class="nstSlider" 
                                     data-range_min="{{ price_min|floatformat:0 }}" 
                                     data-range_max="{{ price_max|floatformat:0 }}" 
                                     data-cur_min="{{ current_price_min|floatformat:0 }}"
                                     data-cur_max="{{ current_price_max|floatformat:0 }}">

                                    <div class="bar"></div>
                                    <div class="leftGrip price-range-grip"></div>
                                    <div class="rightGrip price-range-grip"></div>
                                </div>
                            <div class="range-label-area">
                                <div class="min-price d-flex">
                                    <span class="range-lbl">Min:</span>
                                    <span class="currency-symbol">₹</span>
                                    <div class="leftLabel price-range-label"></div>
                                </div>
                                <div class="min-price d-flex">
                                    <span class="range-lbl">Max:</span>
                                    <span class="currency-symbol">₹</span>
                                    <div class="rightLabel price-range-label"></div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" style="margin-top: 15px; width: 100%; padding: 8px; background: #000; color: #fff; border: none; cursor: pointer;">
                                Apply Price Filter
                            </button>
                            </form>
                        </div>
                        <div class="action-item">
                            <div class="action-top">
                                <span class="action-title">FILTER BY COLOR</span>
                            </div>
                            {% if colors %}
                                {% for color_code in colors %}
                                <a href="{% if selected_subcategory %}{% url 'category-subcategory' category_slug=selected_category.slug subcategory_slug=selected_subcategory.slug %}{% elif selected_category %}{% url 'category-only' category_slug=selected_category.slug %}{% else %}{% url 'shop' %}{% endif %}?{% if selected_brand %}brand={{ selected_brand }}&{% endif %}{% if price_min %}price_min={{ price_min }}&{% endif %}{% if price_max %}price_max={{ price_max }}&{% endif %}color={{ color_code }}" 
                                   class="color-item {% if selected_color == color_code %}selected{% endif %}">
                                    <div class="color" style="background-color: {{ color_code }};">
                                        {% if selected_color == color_code %}<i class="fas fa-check"></i>{% endif %}
                                    </div>
                                    <span class="color-name">{{ color_code|upper }}</span>
                                    <div class="color-arrow"><i class="far fa-long-arrow-right"></i></div>
                                </a>
                                {% endfor %}
                            {% else %}
                                <p style="padding: 10px; color: #999;">No colors available</p>
                            {% endif %}
                            {% if selected_color %}
                            <a href="{% if selected_subcategory %}{% url 'category-subcategory' category_slug=selected_category.slug subcategory_slug=selected_subcategory.slug %}{% elif selected_category %}{% url 'category-only' category_slug=selected_category.slug %}{% else %}{% url 'shop' %}{% endif %}?{% if selected_brand %}brand={{ selected_brand }}&{% endif %}{% if price_min %}price_min={{ price_min }}&{% endif %}{% if price_max %}price_max={{ price_max }}{% endif %}" 
                               class="color-item" style="margin-top: 10px;">
                                <span class="color-name" style="color: #999;">Clear Color Filter</span>
                            </a>
                            {% endif %}
                        </div>
                        <div class="action-item">
                            <div class="action-top">
                                <span class="action-title">FILTER BY BRAND</span>
                            </div>
                            {% if brands %}
                            <div class="product-brands">
                                <div class="brands-inner">
                                    <ul>
                                        {% for brand in brands %}
                                        <li>
                                            <a class="product-brand {% if selected_brand == brand.slug %}active{% endif %}" 
                                               href="{% if selected_subcategory %}{% url 'category-subcategory' category_slug=selected_category.slug subcategory_slug=selected_subcategory.slug %}{% elif selected_category %}{% url 'category-only' category_slug=selected_category.slug %}{% else %}{% url 'shop' %}{% endif %}?{% if selected_color %}color={{ selected_color }}&{% endif %}{% if price_min %}price_min={{ price_min }}&{% endif %}{% if price_max %}price_max={{ price_max }}&{% endif %}brand={{ brand.slug }}">
                                                {{ brand.name }}
                                            </a>
                                        </li>
                                        {% empty %}
                                        <li><span style="color: #999;">No brands found</span></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            {% if selected_brand %}
                            <a href="{% if selected_subcategory %}{% url 'category-subcategory' category_slug=selected_category.slug subcategory_slug=selected_subcategory.slug %}{% elif selected_category %}{% url 'category-only' category_slug=selected_category.slug %}{% else %}{% url 'shop' %}{% endif %}?{% if selected_color %}color={{ selected_color }}&{% endif %}{% if price_min %}price_min={{ price_min }}&{% endif %}{% if price_max %}price_max={{ price_max }}{% endif %}" 
                               style="display: block; padding: 10px; color: #999; text-decoration: underline;">
                                Clear Brand Filter
                            </a>
                            {% endif %}
                            {% else %}
                            <div class="product-brands">
                                <p style="padding: 10px; color: #999;">No brands available in database</p>
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <a href="{% url 'shop' %}" class="banner-item">
                                <div class="banner-inner">
                                    <span class="pretitle">Winter Fashion</span>
                                    <h1 class="title">Behind the
                                        deseart</h1>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- ..::Shop Section Section End Here::.. -->

<!-- ..::Product-details Section Start Here::.. -->
<div class="product-details-popup-wrapper">
    <div class="rts-product-details-section rts-product-details-section2 product-details-popup-section">
        <div class="product-details-popup">
            <button class="product-details-close-btn"><i class="fal fa-times"></i></button>
            <div class="details-product-area">
                <div class="product-thumb-area">
                    <div class="cursor"></div>
                    <div class="thumb-wrapper one filterd-items figure">
                        <div class="product-thumb zoom" onmousemove="zoom(event)"
                            style="background-image: url('/static/images/products/product-details.jpg')"><img
                                src="/static/images/products/product-details.jpg" alt="product-thumb">
                        </div>
                    </div>
                    <div class="thumb-wrapper two filterd-items hide">
                        <div class="product-thumb zoom" onmousemove="zoom(event)"
                            style="background-image: url('/static/images/products/product-filt2.jpg')"><img
                                src="/static/images/products/product-filt2.jpg" alt="product-thumb">
                        </div>
                    </div>
                    <div class="thumb-wrapper three filterd-items hide">
                        <div class="product-thumb zoom" onmousemove="zoom(event)"
                            style="background-image: url('/static/images/products/product-filt3.jpg')"><img
                                src="/static/images/products/product-filt3.jpg" alt="product-thumb">
                        </div>
                    </div>
                    <div class="product-thumb-filter-group">
                        <div class="thumb-filter filter-btn active" data-show=".one"><img
                                src="/static/images/products/product-filt1.jpg" alt="product-thumb-filter"></div>
                        <div class="thumb-filter filter-btn" data-show=".two"><img
                                src="/static/images/products/product-filt2.jpg" alt="product-thumb-filter"></div>
                        <div class="thumb-filter filter-btn" data-show=".three"><img
                                src="/static/images/products/product-filt3.jpg" alt="product-thumb-filter"></div>
                    </div>
                </div>
                <div class="contents">
                    <div class="product-status">
                        <span class="product-catagory">Dress</span>
                        <div class="rating-stars-group">
                            <div class="rating-star"><i class="fas fa-star"></i></div>
                            <div class="rating-star"><i class="fas fa-star"></i></div>
                            <div class="rating-star"><i class="fas fa-star-half-alt"></i></div>
                            <span>10 Reviews</span>
                        </div>
                    </div>
                    <h2 class="product-title">Wide Cotton Tunic Dress <span class="stock">In Stock</span></h2>
                    <span class="product-price"><span class="old-price">$9.35</span> $7.25</span>
                    <p>
                        Priyoshop has brought to you the Hijab 3 Pieces Combo Pack PS23. It is a
                        completely modern design and you feel comfortable to put on this hijab.
                        Buy it at the best price.
                    </p>
                    <div class="product-bottom-action">
                        <div class="cart-edit">
                            <div class="quantity-edit action-item">
                                <button class="button minus"><i class="fal fa-minus minus"></i></button>
                                <input type="text" class="input" value="01" />
                                <button class="button plus">+<i class="fal fa-plus plus"></i></button>
                            </div>
                        </div>
                        <a href="{% url 'cart' %}" class="addto-cart-btn action-item"><i class="rt-basket-shopping"></i>
                            Add To
                            Cart</a>
                        <a href="{% url 'wishlist' %}" class="wishlist-btn action-item"><i class="rt-heart"></i></a>
                    </div>
                    <div class="product-uniques">
                        <span class="sku product-unipue"><span>SKU: </span> BO1D0MX8SJ</span>
                        <span class="catagorys product-unipue"><span>Categories: </span> T-Shirts, Tops, Mens</span>
                        <span class="tags product-unipue"><span>Tags: </span> fashion, t-shirts, Men</span>
                    </div>
                    <div class="share-social">
                        <span>Share:</span>
                        <a class="platform" href="http://facebook.com" target="_blank"><i
                                class="fab fa-facebook-f"></i></a>
                        <a class="platform" href="http://twitter.com" target="_blank"><i
                                class="fab fa-twitter"></i></a>
                        <a class="platform" href="http://behance.com" target="_blank"><i
                                class="fab fa-behance"></i></a>
                        <a class="platform" href="http://youtube.com" target="_blank"><i
                                class="fab fa-youtube"></i></a>
                        <a class="platform" href="http://linkedin.com" target="_blank"><i
                                class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- ..::Product-details Section End Here::.. -->

{% endblock content %}

{% block script %}
<script>
(function($) {
    $(document).ready(function() {
        // Initialize price slider
        if ($('.nstSlider').length) {
            var isInitializing = true;
            var initialMin = parseFloat($('#price_min').val()) || 0;
            var initialMax = parseFloat($('#price_max').val()) || 10000;
            
            // Set initial label values
            $('.leftLabel').text(Math.round(initialMin));
            $('.rightLabel').text(Math.round(initialMax));
            
            $('.nstSlider').nstSlider({
                "left_grip_selector": ".leftGrip",
                "right_grip_selector": ".rightGrip",
                "value_bar_selector": ".bar",
                "value_changed_callback": function(cause, leftValue, rightValue) {
                    // Update hidden inputs
                    var newMin = parseFloat(leftValue);
                    var newMax = parseFloat(rightValue);
                    $('#price_min').val(newMin);
                    $('#price_max').val(newMax);
                    
                    // Update labels
                    $('.leftLabel').text(Math.round(newMin));
                    $('.rightLabel').text(Math.round(newMax));
                    
                    // Mark that initialization is complete after first callback
                    if (isInitializing) {
                        isInitializing = false;
                    }
                },
                "highlight": {
                    "grip_class": "grip",
                    "panel_selector": ".bar"
                }
            });
            
            // Prevent form auto-submit on page load
            $('#price-filter-form').on('submit', function(e) {
                // Only allow manual submission via button
                if (!$(document.activeElement).is('button[type="submit"]')) {
                    e.preventDefault();
                    return false;
                }
            });
        }
    });
})(jQuery || django.jQuery);
</script>
{% endblock script %}