{% extends 'base.html' %}
{% load static %}

{% block body %}

<!-- Products Section -->
<section class="products-section">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <div class="page-title">
        <h1>Our Products</h1>
        <p>Discover our complete collection of premium products</p>
      </div>
    </div>

    <!-- Filters and Sorting -->
    <div class="products-controls">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="products-count">
            <span class="count-text">Showing <strong>{{ products|length }}</strong> products</span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="products-sort">
            <select class="sort-select" id="sortSelect">
              <option value="newest">Newest First</option>
              <option value="oldest">Oldest First</option>
              <option value="price-low">Price: Low to High</option>
              <option value="price-high">Price: High to Low</option>
              <option value="name">Name A-Z</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="products-grid">
      {% if products %}
        <div class="row latest-products-grid" id="productsContainer">
          {% for product in products %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 latest-product-item product-item {{ product.subcategory.slug }}" data-price="{{ product.price }}" data-name="{{ product.name|lower }}" data-date="{{ product.id }}">
              <div class="latest-product-card">
                <!-- Product Image -->
                <div class="latest-product-img">
                  {% if product.images.first %}
                    <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="product-main-image" />
                  {% else %}
                    <img src="{% static 'img/items/str-img1.webp' %}" alt="{{ product.name }}" class="product-main-image" />
                  {% endif %}
                  <div class="latest-product-overlay">
                    <button type="button" data-toggle="modal" data-target="#quickview{{ product.id }}" class="quick-view-btn">
                      <i class="ti-eye"></i>
                      <span>Quick View</span>
                    </button>
                    <a href="{% url 'product_detail' product.slug %}" class="view-details-btn">
                      <i class="ti-link"></i>
                      <span>View Details</span>
                    </a>
                  </div>
                  {% if product.offerprice and product.offerprice < product.price %}
                    <div class="latest-product-badge">
                      <span class="badge-text">Sale</span>
                    </div>
                  {% elif product.featured %}
                    <div class="latest-product-badge">
                      <span class="badge-text">Featured</span>
                    </div>
                  {% elif product.latest %}
                    <div class="latest-product-badge">
                      <span class="badge-text">Latest</span>
                    </div>
                  {% elif product.popular %}
                    <div class="latest-product-badge">
                      <span class="badge-text">Popular</span>
                    </div>
                  {% endif %}
                </div>

                <!-- Product Info -->
                <div class="latest-product-info">
                  <div class="latest-product-category">
                    <span>{{ product.subcategory.name }}</span>
                  </div>
                  <h4 class="latest-product-name">{{ product.name }}</h4>
                  <div class="latest-product-price">
                    {% if product.offerprice and product.offerprice < product.price %}
                      <span class="current-price">₹{{ product.offerprice }}</span>
                      <span class="original-price">₹{{ product.price }}</span>
                      <span class="discount-percentage">
                        {% widthratio product.price|add:"-"|add:product.offerprice product.price 100 %}% OFF
                      </span>
                    {% else %}
                      <span class="current-price">₹{{ product.price }}</span>
                    {% endif %}
                  </div>
                  {% if product.short_description %}
                    <p class="latest-product-description">{{ product.short_description|truncatewords:15 }}</p>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Quick View Modal -->
            <div class="modal fade latest-quickview-modal" id="quickview{{ product.id }}" tabindex="-1" role="dialog" aria-labelledby="quickview" aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-content latest-modal-content">
                  <div class="modal-header latest-modal-header">
                    <h5 class="modal-title">Quick View</h5>
                    <button type="button" class="close latest-modal-close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>

                  <div class="modal-body latest-modal-body">
                    <div class="latest-quickview-content">
                      <div class="row">
                        <div class="col-12 col-lg-6">
                          <div class="latest-quickview-image">
                            {% if product.images.first %}
                              <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="img-fluid" />
                            {% else %}
                              <img src="{% static 'img/items/str-img1.webp' %}" alt="{{ product.name }}" class="img-fluid" />
                            {% endif %}
                          </div>
                        </div>
                        <div class="col-12 col-lg-6">
                          <div class="latest-quickview-details">
                            <div class="latest-quickview-category">{{ product.subcategory.name }}</div>
                            <h4 class="latest-quickview-title">{{ product.name }}</h4>
                            <div class="latest-quickview-price">
                              {% if product.offerprice and product.offerprice < product.price %}
                                <span class="current-price">₹{{ product.offerprice }}</span>
                                <span class="original-price">₹{{ product.price }}</span>
                              {% else %}
                                <span class="current-price">₹{{ product.price }}</span>
                              {% endif %}
                            </div>
                            {% if product.short_description %}
                              <p class="latest-quickview-description">{{ product.short_description }}</p>
                            {% endif %}
                            <div class="latest-quickview-actions">
                              <a href="{% url 'product_detail' product.slug %}" class="latest-view-details-btn">
                                <i class="ti-link"></i>
                                <span>View Full Details</span>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="latest-empty-state">
          <div class="empty-state-icon">
            <i class="fa fa-box-open"></i>
          </div>
          <h4>No Products Available</h4>
          <p>We're working on adding more amazing products. Check back soon!</p>
          <a href="{% url 'home' %}" class="continue-shopping-btn">
            <i class="fa fa-home"></i>
            Back to Home
          </a>
        </div>
      {% endif %}
    </div>

    <!-- Load More Button (if needed for pagination) -->
    {% if products|length > 12 %}
      <div class="load-more-section">
        <button class="load-more-btn" id="loadMoreBtn">
          <i class="fa fa-plus"></i>
          Load More Products
        </button>
      </div>
    {% endif %}
  </div>
</section>

<!-- Special Offer Section -->
<section class="special-offer-section">
  <div class="container">
    <div class="offer-banner">
      <div class="row align-items-center">
        <div class="col-md-8">
          <div class="offer-content">
            <h2>A Jhumkabali Exclusive <span class="hot-badge">Hot</span></h2>
            <p>* THE WORLD OF JANOS TÖRÖK</p>
            <div class="offer-price">
              <h3><span class="regular-price">₹599.90</span> ₹499.90</h3>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="offer-action">
            <a href="#" class="offer-btn">
              <i class="fa fa-shopping-cart"></i>
              Shop Now
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Testimonials Section -->
<section class="testimonials-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">What Our Customers Say</h2>
      <p class="section-subtitle">Real feedback from satisfied customers</p>
    </div>

    <div class="testimonials-slider">
      <div class="testimonial-item">
        <div class="testimonial-content">
          <div class="quote-icon">
            <i class="fa fa-quote-left"></i>
          </div>
          <p class="testimonial-text">
            "The quality of products is exceptional! I've been shopping here for months and every purchase has exceeded my expectations. The customer service is also outstanding."
          </p>
          <div class="testimonial-author">
            <div class="author-image">
              <img src="{% static 'img/bg-img/tes-1.jpg' %}" alt="Priya Sharma">
            </div>
            <div class="author-info">
              <h5>Priya Sharma</h5>
              <span>Mumbai, India</span>
            </div>
          </div>
        </div>
      </div>

      <div class="testimonial-item">
        <div class="testimonial-content">
          <div class="quote-icon">
            <i class="fa fa-quote-left"></i>
          </div>
          <p class="testimonial-text">
            "Amazing collection of beauty products! The makeup kits are perfect for Indian skin tones and the jewelry pieces are absolutely stunning. Highly recommended!"
          </p>
          <div class="testimonial-author">
            <div class="author-image">
              <img src="{% static 'img/bg-img/tes-1.jpg' %}" alt="Anjali Patel">
            </div>
            <div class="author-info">
              <h5>Anjali Patel</h5>
              <span>Delhi, India</span>
            </div>
          </div>
        </div>
      </div>

      <div class="testimonial-item">
        <div class="testimonial-content">
          <div class="quote-icon">
            <i class="fa fa-quote-left"></i>
          </div>
          <p class="testimonial-text">
            "Fast delivery and excellent packaging! The products arrived in perfect condition. The variety of options available is impressive. Will definitely shop again!"
          </p>
          <div class="testimonial-author">
            <div class="author-image">
              <img src="{% static 'img/bg-img/tes-1.jpg' %}" alt="Kavya Reddy">
            </div>
            <div class="author-info">
              <h5>Kavya Reddy</h5>
              <span>Bangalore, India</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Product sorting functionality
    const sortSelect = document.getElementById('sortSelect');
    const productsContainer = document.getElementById('productsContainer');
    
    if (sortSelect && productsContainer) {
        sortSelect.addEventListener('change', function() {
            const sortValue = this.value;
            const productItems = Array.from(productsContainer.querySelectorAll('.product-item'));
            
            productItems.sort(function(a, b) {
                switch(sortValue) {
                    case 'newest':
                        return parseInt(b.dataset.date) - parseInt(a.dataset.date);
                    case 'oldest':
                        return parseInt(a.dataset.date) - parseInt(b.dataset.date);
                    case 'price-low':
                        return parseFloat(a.dataset.price) - parseFloat(b.dataset.price);
                    case 'price-high':
                        return parseFloat(b.dataset.price) - parseFloat(a.dataset.price);
                    case 'name':
                        return a.dataset.name.localeCompare(b.dataset.name);
                    default:
                        return 0;
                }
            });
            
            // Clear container and re-append sorted items
            productsContainer.innerHTML = '';
            productItems.forEach(item => {
                productsContainer.appendChild(item);
            });
        });
    }
    
    // Load more functionality (if needed)
    const loadMoreBtn = document.getElementById('loadMoreBtn');
    if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', function() {
            // This would typically make an AJAX request to load more products
            console.log('Load more products functionality would go here');
        });
    }
});
</script>

{% endblock %}